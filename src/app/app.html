<div class="container" [class.game-started]="showWater" [class.danger-mode]="showWater && waterLevel > 50" [style.background]="getDangerBackground()">
  <!-- Evening sky clouds -->
  <div class="sky-clouds" *ngIf="showWater">
    <div class="cloud cloud-1"></div>
    <div class="cloud cloud-2"></div>
    <div class="cloud cloud-3"></div>
    <div class="cloud cloud-4"></div>
  </div>

  <button class="play-button" *ngIf="!showWater" (click)="startWater()">
    <div class="button-corner corner-tl">
      <svg class="corner-icon" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <circle cx="25" cy="25" r="8" fill="currentColor"/>
        <circle cx="25" cy="25" r="15" fill="none" stroke="currentColor" stroke-width="2"/>
      </svg>
    </div>
    <div class="button-corner corner-tr">
      <svg class="corner-icon" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <path d="M15,25 L25,15 L35,25 L25,35 Z" fill="currentColor"/>
      </svg>
    </div>
    <div class="button-corner corner-bl">
      <svg class="corner-icon" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <rect x="15" y="20" width="20" height="10" rx="5" fill="currentColor"/>
      </svg>
    </div>
    <div class="button-corner corner-br">
      <svg class="corner-icon" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <polygon points="20,15 30,15 35,25 30,35 20,35 15,25" fill="currentColor"/>
      </svg>
    </div>
    <div class="button-center">
      <svg class="play-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <polygon points="30,20 30,80 80,50" fill="currentColor"/>
      </svg>
      <span class="play-text">PLAY</span>
    </div>
  </button>

  <div class="water-container" *ngIf="showWater" [style.height]="waterLevel + 'vh'" [style.bottom]="'0'">
    <!-- Deep water base -->
    <div class="water-base"></div>
    
    <!-- Main water body with gradient -->
    <svg class="water-wave main-wave" viewBox="0 0 1400 200" preserveAspectRatio="none">
      <defs>
        <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:rgba(30,144,255,0.9);stop-opacity:1" />
          <stop offset="30%" style="stop-color:rgba(0,191,255,0.8);stop-opacity:1" />
          <stop offset="70%" style="stop-color:rgba(65,105,225,0.9);stop-opacity:1" />
          <stop offset="100%" style="stop-color:rgba(25,25,112,1);stop-opacity:1" />
        </linearGradient>
      </defs>
      <path d="M0,40 C200,20 400,60 600,35 C800,10 1000,50 1200,30 C1300,25 1350,35 1400,30 L1400,200 L0,200 Z" fill="url(#waterGradient)">
        <animate attributeName="d" 
          dur="6s" 
          repeatCount="indefinite"
          values="M0,40 C200,20 400,60 600,35 C800,10 1000,50 1200,30 C1300,25 1350,35 1400,30 L1400,200 L0,200 Z;
                  M0,25 C200,45 400,15 600,50 C800,25 1000,5 1200,45 C1300,40 1350,20 1400,35 L1400,200 L0,200 Z;
                  M0,50 C200,30 400,70 600,25 C800,45 1000,15 1200,40 C1300,35 1350,45 1400,25 L1400,200 L0,200 Z;
                  M0,35 C200,55 400,25 600,60 C800,35 1000,65 1200,25 C1300,30 1350,40 1400,45 L1400,200 L0,200 Z;
                  M0,40 C200,20 400,60 600,35 C800,10 1000,50 1200,30 C1300,25 1350,35 1400,30 L1400,200 L0,200 Z"/>
      </path>
    </svg>

    <!-- Surface waves layer 1 -->
    <svg class="water-wave surface-wave-1" viewBox="0 0 1400 80" preserveAspectRatio="none">
      <path d="M0,20 C150,5 300,35 450,15 C600,0 750,30 900,10 C1050,25 1200,5 1400,20 L1400,80 L0,80 Z" fill="rgba(135,206,250,0.7)">
        <animate attributeName="d" 
          dur="4s" 
          repeatCount="indefinite"
          values="M0,20 C150,5 300,35 450,15 C600,0 750,30 900,10 C1050,25 1200,5 1400,20 L1400,80 L0,80 Z;
                  M0,10 C150,25 300,5 450,30 C600,15 750,0 900,25 C1050,10 1200,30 1400,15 L1400,80 L0,80 Z;
                  M0,30 C150,15 300,25 450,5 C600,35 750,10 900,0 C1050,20 1200,15 1400,25 L1400,80 L0,80 Z;
                  M0,15 C150,30 300,10 450,25 C600,5 750,35 900,15 C1050,0 1200,25 1400,10 L1400,80 L0,80 Z;
                  M0,20 C150,5 300,35 450,15 C600,0 750,30 900,10 C1050,25 1200,5 1400,20 L1400,80 L0,80 Z"/>
      </path>
    </svg>

    <!-- Surface waves layer 2 -->
    <svg class="water-wave surface-wave-2" viewBox="0 0 1400 60" preserveAspectRatio="none">
      <path d="M0,15 C200,25 350,5 550,20 C750,10 950,25 1150,15 C1250,20 1350,10 1400,15 L1400,60 L0,60 Z" fill="rgba(176,224,230,0.6)">
        <animate attributeName="d" 
          dur="3.2s" 
          repeatCount="indefinite"
          values="M0,15 C200,25 350,5 550,20 C750,10 950,25 1150,15 C1250,20 1350,10 1400,15 L1400,60 L0,60 Z;
                  M0,25 C200,5 350,30 550,10 C750,25 950,5 1150,20 C1250,15 1350,25 1400,10 L1400,60 L0,60 Z;
                  M0,10 C200,20 350,15 550,5 C750,30 950,15 1150,25 C1250,10 1350,5 1400,20 L1400,60 L0,60 Z;
                  M0,20 C200,10 350,25 550,15 C750,5 950,30 1150,10 C1250,25 1350,15 1400,25 L1400,60 L0,60 Z;
                  M0,15 C200,25 350,5 550,20 C750,10 950,25 1150,15 C1250,20 1350,10 1400,15 L1400,60 L0,60 Z"/>
      </path>
    </svg>

    <!-- Foam and bubbles layer -->
    <svg class="water-wave foam-layer" viewBox="0 0 1400 40" preserveAspectRatio="none">
      <path d="M0,8 C100,12 200,4 300,10 C400,6 500,14 600,8 C700,12 800,6 900,10 C1000,4 1100,12 1200,8 C1300,10 1350,6 1400,8 L1400,40 L0,40 Z" fill="rgba(255,255,255,0.4)">
        <animate attributeName="d" 
          dur="2.8s" 
          repeatCount="indefinite"
          values="M0,8 C100,12 200,4 300,10 C400,6 500,14 600,8 C700,12 800,6 900,10 C1000,4 1100,12 1200,8 C1300,10 1350,6 1400,8 L1400,40 L0,40 Z;
                  M0,12 C100,4 200,16 300,6 C400,14 500,2 600,12 C700,8 800,14 900,6 C1000,12 1100,4 1200,10 C1300,6 1350,12 1400,4 L1400,40 L0,40 Z;
                  M0,6 C100,10 200,8 300,4 C400,12 500,8 600,14 C700,6 800,10 900,4 C1000,8 1100,14 1200,6 C1300,12 1350,8 1400,10 L1400,40 L0,40 Z;
                  M0,10 C100,6 200,12 300,8 C400,4 500,10 600,6 C700,14 800,4 900,12 C1000,6 1100,8 1200,14 C1300,4 1350,10 1400,6 L1400,40 L0,40 Z;
                  M0,8 C100,12 200,4 300,10 C400,6 500,14 600,8 C700,12 800,6 900,10 C1000,4 1100,12 1200,8 C1300,10 1350,6 1400,8 L1400,40 L0,40 Z"/>
      </path>
    </svg>

    <!-- Floating bubbles -->
    <div class="bubble-container">
      <div class="bubble bubble-1"></div>
      <div class="bubble bubble-2"></div>
      <div class="bubble bubble-3"></div>
      <div class="bubble bubble-4"></div>
      <div class="bubble bubble-5"></div>
      <div class="bubble bubble-6"></div>
    </div>
  </div>

  <button class="config-link" *ngIf="showWater" (click)="toggleConfig()">‚öôÔ∏è Configure</button>

  <div class="score-card" *ngIf="showWater">
    <div class="score-header">SCORE</div>
    <div class="score-number">{{score}}</div>
  </div>

  <div class="config-popup" *ngIf="showWater" [class.open]="showConfig">
    <div class="config-backdrop" *ngIf="showConfig" (click)="closeConfig()"></div>
    <div class="config-content" *ngIf="showConfig">
      <h3>Configuration</h3>
      <div class="config-item">
        <label for="waterLevel">Water Level (%) - Current: {{waterLevel}}vh</label>
        <input type="number" id="waterLevel" [(ngModel)]="waterLevel" min="5" max="100" />
        <input type="range" [(ngModel)]="waterLevel" min="5" max="100" />
      </div>
      <div class="config-item">
        <label for="charactersToTop">Characters to reach 100%</label>
        <input type="number" id="charactersToTop" [(ngModel)]="charactersToTop" min="2" max="25" />
        <input type="range" [(ngModel)]="charactersToTop" min="2" max="25" />
      </div>
      <div class="config-item">
        <label for="fallSpeed">Fall Speed ({{fallSpeed}}x)</label>
        <input type="number" id="fallSpeed" [(ngModel)]="fallSpeed" min="0.2" max="3" step="0.1" />
        <input type="range" [(ngModel)]="fallSpeed" min="0.2" max="3" step="0.1" />
      </div>
      <div class="config-item">
        <label for="maxFallingChars">Max Falling Characters</label>
        <input type="number" id="maxFallingChars" [(ngModel)]="maxFallingChars" min="1" max="10" />
        <input type="range" [(ngModel)]="maxFallingChars" min="1" max="10" />
      </div>
      <button class="close-btn" (click)="closeConfig()">Close</button>
    </div>
  </div>

  <div class="game-over-popup" *ngIf="waterLevel >= 100" [class.show]="waterLevel >= 100">
    <div class="game-over-content">
      <h1 class="game-over-title">üåä GAME OVER! üåä</h1>
      <div class="score-container">
        <span class="score-label">Final Score:</span>
        <span class="score-value">{{score}}</span>
      </div>
      <div class="game-over-message">The water has flooded everything!</div>
      <button class="restart-btn" (click)="restartGame()">üéÆ Play Again</button>
    </div>
  </div>

  <div class="falling-chars" *ngIf="showWater">
    <div 
      *ngFor="let char of fallingChars; trackBy: trackChar" 
      class="falling-char"
      [style.left.px]="char.x"
      [style.top.px]="char.y"
      [style.color]="char.color"
      [style.font-family]="char.font"
      [style.font-size.px]="char.size"
      [style.font-weight]="char.weight"
      [class.popped]="char.popped">
      {{char.character}}
    </div>
    
    <div 
      *ngFor="let confetti of confettiParticles; trackBy: trackConfetti"
      class="confetti-particle"
      [style.left.px]="confetti.x"
      [style.top.px]="confetti.y"
      [style.background-color]="confetti.color"
      [style.animation-delay.ms]="confetti.delay">
    </div>
    
    <div 
      *ngFor="let splash of splashParticles; trackBy: trackSplash"
      class="splash-particle"
      [style.left.px]="splash.x"
      [style.top.px]="splash.y"
      [style.background-color]="splash.color"
      [style.width.px]="splash.size"
      [style.height.px]="splash.size">
    </div>
  </div>
</div>
